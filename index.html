<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×œ×•×— ××•×“×¢×•×ª ×“×™×’×™×˜×œ×™ - ×‘×™×ª ×›× ×¡×ª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;800&family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Heebo', 'Rubik', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            overflow: hidden;
            height: 100vh;
        }
        .gold-accent { color: #d4af37; }
        .gold-border { border-color: #d4af37; }
        .gold-bg { background-color: #d4af37; }
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.6s ease-out forwards; }
        .scroller {
            scrollbar-width: thin;
            scrollbar-color: #d4af37 transparent;
        }
        .scroller::-webkit-scrollbar { width: 6px; }
        .scroller::-webkit-scrollbar-thumb { background: #d4af37; border-radius: 10px; }
        
        /* Login Modal Style */
        #login-modal, #editor-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="p-4 md:p-6">

    <!-- Admin Trigger (Invisible button top left for safety) -->
    <button onclick="showLogin()" class="fixed top-2 left-2 w-10 h-10 opacity-0 hover:opacity-20 transition-opacity gold-accent">âš™ï¸</button>

    <div id="app" class="h-full flex flex-col max-w-[1920px] mx-auto opacity-0 transition-opacity duration-1000">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-6 border-b-2 gold-border pb-6">
            <div class="text-right flex-1">
                <h1 id="synagogue-name" class="text-3xl md:text-5xl font-extrabold gold-accent tracking-tight mb-1"></h1>
                <div class="flex gap-4 text-slate-300 text-lg md:text-xl font-medium">
                    <span id="hebrew-date-display">×˜×•×¢×Ÿ ×ª××¨×™×š...</span>
                    <span class="text-slate-500">|</span>
                    <span class="gold-accent" id="parasha-display">×¤×¨×©×ª ×”×©×‘×•×¢</span>
                </div>
            </div>
            
            <div class="flex flex-col items-center md:items-end flex-1 mt-4 md:mt-0">
                <div id="live-clock" class="text-5xl md:text-7xl font-bold tracking-widest tabular-nums mb-1">00:00:00</div>
                <div id="gregorian-date" class="text-xl md:text-2xl text-slate-400"></div>
            </div>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-3 gap-6 flex-1 overflow-hidden">
            <!-- Col 1: Prayer Times -->
            <section class="glass rounded-2xl p-6 flex flex-col h-full shadow-2xl overflow-hidden">
                <div class="flex items-center gap-3 mb-4 border-b gold-border/30 pb-3">
                    <span class="gold-accent text-2xl">ğŸ•’</span>
                    <h2 class="text-2xl font-bold gold-accent">×–×× ×™ ×ª×¤×™×œ×•×ª</h2>
                </div>
                <div id="prayer-list" class="space-y-3 overflow-y-auto scroller"></div>
            </section>

            <!-- Col 2: Zmanim & Weather -->
            <div class="flex flex-col gap-6 h-full overflow-y-auto scroller">
                <section class="glass rounded-2xl p-5 shadow-2xl">
                    <div class="flex items-center gap-3 mb-3 border-b gold-border/30 pb-2">
                        <span class="gold-accent text-2xl">ğŸ•¯ï¸</span>
                        <h2 class="text-xl font-bold gold-accent">×–×× ×™ ×”×™×•× ×•×©×‘×ª</h2>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-slate-800/40 p-3 rounded-xl border border-slate-700/50 flex flex-col items-center">
                            <span class="text-sm text-slate-400">× ×¥ ×”×—××”</span>
                            <span id="netz-time" class="text-xl font-bold">--:--</span>
                        </div>
                        <div class="bg-slate-800/40 p-3 rounded-xl border border-slate-700/50 flex flex-col items-center">
                            <span class="text-sm text-slate-400">×©×§×™×¢×”</span>
                            <span id="shkia-time" class="text-xl font-bold">--:--</span>
                        </div>
                        <div class="bg-amber-900/20 p-3 rounded-xl border border-amber-600/30 flex flex-col items-center">
                            <span class="text-sm text-amber-200">×”×“×œ×§×ª × ×¨×•×ª</span>
                            <span id="candles-time" class="text-xl font-bold">--:--</span>
                        </div>
                        <div class="bg-indigo-900/20 p-3 rounded-xl border border-indigo-600/30 flex flex-col items-center">
                            <span class="text-sm text-indigo-200">×¦××ª ×”×©×‘×ª</span>
                            <span id="havdalah-time" class="text-xl font-bold">--:--</span>
                        </div>
                    </div>
                </section>

                <section class="glass rounded-2xl p-5 shadow-2xl">
                    <div class="flex items-center gap-3 mb-3 border-b gold-border/30 pb-2">
                        <span class="gold-accent text-2xl">ğŸŒ</span>
                        <h2 class="text-xl font-bold gold-accent">××–×’ ××•×•×™×¨ ×•×œ×‘× ×”</h2>
                    </div>
                    <div class="flex justify-around items-center">
                        <div class="text-center">
                            <div id="weather-icon" class="text-4xl mb-1">â˜ï¸</div>
                            <div id="weather-temp" class="text-2xl font-bold">--Â°C</div>
                            <div id="weather-desc" class="text-xs text-slate-400">×˜×•×¢×Ÿ...</div>
                        </div>
                        <div class="w-px h-12 bg-slate-700"></div>
                        <div class="text-center">
                            <div id="moon-icon" class="text-4xl mb-1">ğŸŒ‘</div>
                            <div id="moon-phase-name" class="text-lg font-bold">--</div>
                            <div id="moon-percent" class="text-xs text-slate-400">××¦×‘ ×”×œ×‘× ×”</div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Col 3: Community Events -->
            <section class="glass rounded-2xl p-6 flex flex-col h-full shadow-2xl overflow-hidden">
                <div class="flex items-center gap-3 mb-4 border-b gold-border/30 pb-3">
                    <span class="gold-accent text-2xl">ğŸ“¢</span>
                    <h2 class="text-2xl font-bold gold-accent">×”×•×“×¢×•×ª ×”×§×”×™×œ×”</h2>
                </div>
                <div id="events-list" class="flex-1 overflow-y-auto scroller space-y-4"></div>
            </section>
        </main>

        <footer class="mt-4 py-3 px-6 glass rounded-xl flex justify-between items-center text-slate-400 text-xs">
            <div id="footer-copy"></div>
            <div class="flex gap-4">
                <span>× ×•×¡×—: ×¢×“×•×ª ×”××–×¨×—</span>
                <span class="text-slate-600">|</span>
                <span id="last-update">×¢×•×“×›×Ÿ ×›×¢×ª</span>
            </div>
        </footer>
    </div>

    <!-- Login Modal -->
    <div id="login-modal">
        <div class="bg-slate-800 p-8 rounded-2xl border gold-border w-80 shadow-2xl">
            <h2 class="text-2xl font-bold gold-accent mb-4 text-center">×›× ×™×¡×ª ×× ×”×œ</h2>
            <input type="text" id="admin-user" placeholder="×©× ××©×ª××©" class="w-full bg-slate-900 border border-slate-700 p-2 rounded mb-3 outline-none focus:border-yellow-600">
            <input type="password" id="admin-pass" placeholder="×¡×™×¡××”" class="w-full bg-slate-900 border border-slate-700 p-2 rounded mb-4 outline-none focus:border-yellow-600">
            <button onclick="attemptLogin()" class="w-full gold-bg text-slate-900 font-bold p-2 rounded hover:brightness-110">×”×ª×—×‘×¨</button>
            <button onclick="closeModal('login-modal')" class="w-full text-slate-400 mt-2 text-sm">×‘×™×˜×•×œ</button>
        </div>
    </div>

    <!-- Editor Modal -->
    <div id="editor-modal">
        <div class="bg-slate-800 p-6 rounded-2xl border gold-border w-full max-w-2xl max-h-[90vh] overflow-y-auto scroller shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold gold-accent">× ×™×”×•×œ ××™×¨×•×¢×™×</h2>
                <button onclick="addEventUI()" class="bg-green-600 text-white px-3 py-1 rounded text-sm">+ ×”×•×¡×£ ××™×¨×•×¢</button>
            </div>
            <div id="editor-list" class="space-y-4 mb-6"></div>
            <div class="flex gap-3">
                <button onclick="saveAllEvents()" class="flex-1 gold-bg text-slate-900 font-bold p-3 rounded">×©××•×¨ ×©×™× ×•×™×™×</button>
                <button onclick="closeModal('editor-modal')" class="flex-1 bg-slate-700 p-3 rounded">×¡×’×•×¨</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * CONFIGURATION
         */
        const CONFIG = {
            SYNAGOGUE_NAME: '×§×”×™×œ×ª "××•×¨ ×”×ª×•×¨×”" ×•×”×—×¡×“',
            CITY_ID: '281184', // ×™×¨×•×©×œ×™×
            LAT: 31.7683,
            LON: 35.2137,
            ADMIN_USER: 'admin',
            ADMIN_PASS: '1234', // ××•××œ×¥ ×œ×©× ×•×ª ×œ×¤× ×™ ×”×¢×œ××”
            PRAYER_TIMES: [
                { name: '×©×—×¨×™×ª ×\'', time: '06:30' },
                { name: '×©×—×¨×™×ª ×‘\'', time: '08:00' },
                { name: '×× ×—×” ×’×“×•×œ×”', time: '13:30' },
                { name: '×× ×—×” ×•×¢×¨×‘×™×ª', time: '15 ×“×§\' ×œ×¤× ×™ ×©×§×™×¢×”' },
                { name: '×¢×¨×‘×™×ª ×‘\'', time: '20:30' }
            ],
            DEFAULT_EVENTS: [
                { type: '××–×œ ×˜×•×‘', title: '×œ××©×¤×—×ª ×œ×•×™', description: '×œ×¨×’×œ ×”×•×œ×“×ª ×”×‘×Ÿ! ×©×œ×•× ×–×›×¨ ×‘×‘×™×ª ×”××©×¤×—×”.' },
                { type: '×©×™×¢×•×¨', title: '×“×£ ×”×™×•××™', description: '×‘×›×œ ×‘×•×§×¨ ×œ××—×¨ ×”×ª×¤×™×œ×”.' }
            ]
        };

        let currentEvents = JSON.parse(localStorage.getItem('synagogue_events')) || CONFIG.DEFAULT_EVENTS;

        // UI Core
        function updateClock() {
            const now = new Date();
            document.getElementById('live-clock').textContent = now.toLocaleTimeString('he-IL', { hour12: false });
            document.getElementById('gregorian-date').textContent = now.toLocaleDateString('he-IL', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        }

        async function fetchData() {
            try {
                // Hebcal (Zmanim & Date)
                const hRes = await fetch(`https://www.hebcal.com/shabbat?cfg=json&geonameid=${CONFIG.CITY_ID}&m=50`);
                const hData = await hRes.json();
                const zRes = await fetch(`https://www.hebcal.com/zmanim?cfg=json&geonameid=${CONFIG.CITY_ID}`);
                const zData = await zRes.json();
                const convRes = await fetch(`https://www.hebcal.com/converter?cfg=json&gy=${new Date().getFullYear()}&gm=${new Date().getMonth()+1}&gd=${new Date().getDate()}&g2h=1`);
                const conv = await convRes.json();

                // Weather (Open-Meteo)
                const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${CONFIG.LAT}&longitude=${CONFIG.LON}&current_weather=true`);
                const wData = await wRes.json();

                updateUI(hData, zData, conv, wData.current_weather);
            } catch (e) { console.error(e); }
        }

        function updateUI(shabbat, zmanim, hdate, weather) {
            const formatT = (iso) => iso ? new Date(iso).toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit', hour12: false }) : '--:--';
            
            document.getElementById('candles-time').textContent = formatT(shabbat.items.find(i => i.category === 'candles')?.date);
            document.getElementById('havdalah-time').textContent = formatT(shabbat.items.find(i => i.category === 'havdalah')?.date);
            document.getElementById('parasha-display').textContent = `×¤×¨×©×ª ${shabbat.items.find(i => i.category === 'parashat')?.hebrew || '...'}`;
            document.getElementById('netz-time').textContent = formatT(zmanim.times.sunrise);
            document.getElementById('shkia-time').textContent = formatT(zmanim.times.sunset);
            document.getElementById('hebrew-date-display').textContent = `${hdate.hd} ×‘${hdate.hm} ${hdate.hy}`;
            
            // Weather UI
            document.getElementById('weather-temp').textContent = `${Math.round(weather.temperature)}Â°C`;
            const wCodes = { 0: "×‘×”×™×¨", 1: "×‘×”×™×¨ ×œ×¨×•×‘", 2: "××¢×•× ×Ÿ ×—×œ×§×™×ª", 3: "××¢×•× ×Ÿ", 45: "×¢×¨×¤×™×œ×™", 61: "×’×©× ×§×œ", 95: "×¡×•×¤×•×ª ×¨×¢××™×" };
            document.getElementById('weather-desc').textContent = wCodes[weather.weathercode] || "× ××”";
            document.getElementById('weather-icon').textContent = weather.weathercode < 3 ? "â˜€ï¸" : weather.weathercode < 60 ? "â˜ï¸" : "ğŸŒ§ï¸";

            // Moon Phase Calculation
            const moon = calculateMoonPhase(new Date());
            document.getElementById('moon-icon').textContent = moon.icon;
            document.getElementById('moon-phase-name').textContent = moon.name;
            document.getElementById('moon-percent').textContent = `× ×¨××•×ª: ${Math.round(moon.phase * 100)}%`;

            renderEvents();
        }

        function calculateMoonPhase(date) {
            const cycle = 29.530588853;
            const knownNewMoon = new Date("2000-01-06T18:14:00Z");
            const diff = (date - knownNewMoon) / 1000 / 60 / 60 / 24;
            const phase = (diff % cycle) / cycle;
            
            if (phase < 0.05 || phase > 0.95) return { name: "××•×œ×“ ×”×œ×‘× ×”", icon: "ğŸŒ‘", phase };
            if (phase < 0.25) return { name: "×¡×”×¨ ××ª××œ×", icon: "ğŸŒ’", phase };
            if (phase < 0.35) return { name: "×—×¦×™ ×œ×‘× ×”", icon: "ğŸŒ“", phase };
            if (phase < 0.50) return { name: "×œ×§×¨××ª ××™×œ×•×™", icon: "ğŸŒ”", phase };
            if (phase < 0.60) return { name: "×œ×‘× ×” ×‘××™×œ×•××”", icon: "ğŸŒ•", phase };
            if (phase < 0.75) return { name: "×“×¢×™×›×”", icon: "ğŸŒ–", phase };
            if (phase < 0.85) return { name: "×—×¦×™ ×“×•×¢×š", icon: "ğŸŒ—", phase };
            return { name: "×¡×”×¨ ×“×•×¢×š", icon: "ğŸŒ˜", phase };
        }

        function renderEvents() {
            const list = document.getElementById('events-list');
            list.innerHTML = currentEvents.map(e => `
                <div class="p-5 rounded-xl bg-slate-800/60 border-r-4 gold-border relative animate-fade-in shadow-lg">
                    <div class="absolute top-0 left-0 p-1 px-3 gold-bg text-slate-900 text-xs font-bold uppercase">${e.type}</div>
                    <h3 class="text-xl font-bold text-white mb-1 mt-2">${e.title}</h3>
                    <p class="text-slate-300 text-lg leading-snug">${e.description}</p>
                </div>
            `).join('');
        }

        // Admin Logic
        function showLogin() { document.getElementById('login-modal').style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        function attemptLogin() {
            const u = document.getElementById('admin-user').value;
            const p = document.getElementById('admin-pass').value;
            if (u === CONFIG.ADMIN_USER && p === CONFIG.ADMIN_PASS) {
                closeModal('login-modal');
                showEditor();
            } else { alert('×¤×¨×˜×™× ×©×’×•×™×™×'); }
        }

        function showEditor() {
            document.getElementById('editor-modal').style.display = 'flex';
            const editorList = document.getElementById('editor-list');
            editorList.innerHTML = currentEvents.map((e, i) => `
                <div class="bg-slate-900 p-4 rounded-xl border border-slate-700 relative">
                    <button onclick="removeEvent(${i})" class="absolute top-2 left-2 text-red-500 font-bold">ğŸ—‘ï¸</button>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input type="text" value="${e.type}" placeholder="×¡×•×’ (××–×œ ×˜×•×‘/×©×™×¢×•×¨)" class="bg-slate-800 p-1 rounded border border-slate-700 event-type-${i}">
                        <input type="text" value="${e.title}" placeholder="×›×•×ª×¨×ª" class="bg-slate-800 p-1 rounded border border-slate-700 event-title-${i}">
                    </div>
                    <textarea placeholder="×ª×™××•×¨" class="w-full bg-slate-800 p-1 rounded border border-slate-700 event-desc-${i}">${e.description}</textarea>
                </div>
            `).join('');
        }

        function addEventUI() {
            currentEvents.push({ type: '×”×•×“×¢×”', title: '×›×•×ª×¨×ª ×—×“×©×”', description: '×ª×•×›×Ÿ ×”×”×•×“×¢×”...' });
            showEditor();
        }

        function removeEvent(i) {
            currentEvents.splice(i, 1);
            showEditor();
        }

        function saveAllEvents() {
            const newEvents = [];
            currentEvents.forEach((_, i) => {
                newEvents.push({
                    type: document.querySelector(`.event-type-${i}`).value,
                    title: document.querySelector(`.event-title-${i}`).value,
                    description: document.querySelector(`.event-desc-${i}`).value
                });
            });
            currentEvents = newEvents;
            localStorage.setItem('synagogue_events', JSON.stringify(currentEvents));
            renderEvents();
            closeModal('editor-modal');
        }

        function init() {
            document.getElementById('synagogue-name').textContent = CONFIG.SYNAGOGUE_NAME;
            document.getElementById('footer-copy').textContent = `Â© ${CONFIG.SYNAGOGUE_NAME} | ×”×œ×•×— ×”×“×™×’×™×˜×œ×™ ×”×§×”×™×œ×ª×™`;
            
            const prayerList = document.getElementById('prayer-list');
            prayerList.innerHTML = CONFIG.PRAYER_TIMES.map(p => `
                <div class="flex justify-between items-center p-4 rounded-xl bg-slate-800/40 border border-slate-700/30 transition-all">
                    <span class="text-xl font-semibold text-white">${p.name}</span>
                    <span class="text-2xl font-bold gold-accent tabular-nums">${p.time}</span>
                </div>
            `).join('');

            setInterval(updateClock, 1000);
            updateClock();
            fetchData();
            setInterval(fetchData, 1000 * 60 * 30);
            document.getElementById('app').style.opacity = '1';
        }

        init();
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>